<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pick & Ban Overlay - Template</title>
  <style>
    :root{--slot-w:96px;--slot-h:96px;--muted:#93a3b8;--accent:#00d4ff;--gap:8px}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{background:transparent;color:#e6f6ff}
    .wrap{width:1280px;max-width:100%;margin:18px auto;display:flex;gap:20px;align-items:flex-start}
    .overlay{flex:1;background:transparent;border-radius:12px;padding:12px}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .teams{display:flex;justify-content:center;gap:0}
    .draft-wrapper{position:relative;display:flex;gap:40px;border-radius:10px;padding:10px;box-sizing:border-box;background:rgba(10,20,40,0.18);align-items:center}
    .pick-ban-wrapper{width:calc(var(--slot-w) * 5 + var(--gap) * 4);display:flex;flex-direction:column;align-items:flex-start;border-radius:10px;padding:6px;box-sizing:border-box;background:transparent}
    .teamB .pick-ban-wrapper{align-items:flex-end}
    .slot-row{display:flex;gap:var(--gap);margin:0}
    .slot{box-sizing:border-box;width:var(--slot-w);height:var(--slot-h);border:2px solid #0a3d91;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .slot.empty{opacity:0.9}
    .slot .label{position:absolute;bottom:6px;left:6px;font-size:11px;color:var(--muted);background:rgba(0,0,0,0.35);padding:2px 6px;border-radius:6px}
    .bans{display:flex;gap:6px;margin-top:6px}
    .ban{position:relative;box-sizing:border-box;border:2px solid #0a3d91;width:60px;height:60px;border-radius:6px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .vs-slot{width:96px;height:96px;margin:0 12px;position:relative;display:flex;align-items:center;justify-content:center}
    .admin{}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .btn{background:var(--accent);color:#051423;padding:6px 10px;border-radius:8px;border:none;cursor:pointer;font-weight:700;text-align:center}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .thumbs{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
    .thumb{height:72px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden}
    .thumb .name{position:absolute;bottom:6px;left:6px;font-size:11px;color:var(--muted);background:rgba(0,0,0,0.3);padding:2px 6px;border-radius:6px}
    .status{font-size:13px;color:var(--muted);margin-top:6px}
    .flash{animation:flash .8s ease}
    @keyframes flash{0%{filter:brightness(1)}50%{filter:brightness(1.4)}100%{filter:brightness(1)}}
    .slot img,.ban img,.thumb img,.vs-slot img{width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0;display:block}
    .ban.banned img{filter:grayscale(100%) brightness(0.5);} .ban .ban-x{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:800;color:#ff4444;pointer-events:none}
    .pop{animation:popGrow 0.25s ease forwards} @keyframes popGrow{0%{transform:scale(1)}40%{transform:scale(1.18)}100%{transform:scale(1)}}
    .team-score{width:56px;height:26px;text-align:center;font-size:14px;font-weight:700;background:rgba(0,0,0,0.35);border:none;border-radius:6px;color:#fff;outline:none}
    #phaseLabel{font-size:13px;color:var(--muted)}
    #phaseTimer{font-size:26px;color:#000;font-weight:800}
    @media (max-width:1100px){ .wrap{flex-direction:column;padding:12px} .admin{width:100%} .pick-ban-wrapper{width:100%;box-sizing:border-box} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="overlay" id="overlay">
      <div class="header">
        <div>
          <div style="font-weight:700;font-size:18px">Pick / Ban Overlay (Preview)</div>
          <div style="color:var(--muted);font-size:13px">Best resolution: 1920×1080 — Drag into OBS as Browser Source</div>
        </div>
        <div style="color:var(--muted);font-size:13px">Phase: <strong id="phase">PICK</strong></div>
      </div>

      <div class="teams">
        <div class="draft-wrapper">
          <!-- Team A (left) -->
          <div class="team teamA" id="teamA">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
              <div id="teamALogo" style="width:40px;height:40px;border:none;border-radius:6px;overflow:hidden;position:relative;cursor:pointer;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.05)">
                <span style="font-size:10px;color:#bbb">Logo</span>
                <input type="file" id="teamALogoFile" accept="image/*" style="display:none" />
              </div>
              <div style="display:flex;flex-direction:column;gap:4px">
                <div style="font-weight:700" id="teamAName">BLUE TEAM</div>
                <input id="teamAScore" class="team-score" value="0" />
              </div>
            </div>

            <div class="pick-ban-wrapper">
              <div class="slot-row" id="teamA-picks">
                <div class="slot empty" data-team="A" data-index="0"><div class="label">P1</div></div>
                <div class="slot empty" data-team="A" data-index="1"><div class="label">P2</div></div>
                <div class="slot empty" data-team="A" data-index="2"><div class="label">P3</div></div>
                <div class="slot empty" data-team="A" data-index="3"><div class="label">P4</div></div>
                <div class="slot empty" data-team="A" data-index="4"><div class="label">P5</div><input id="scoreA" class="score-input" value="0" style="display:none"/></div>
              </div>
              <div class="bans" id="teamA-bans">
                <div class="ban" data-team="A" data-ban="0"></div>
                <div class="ban" data-team="A" data-ban="1"></div>
                <div class="ban" data-team="A" data-ban="2"></div>
                <div class="ban" data-team="A" data-ban="3"></div>
              </div>
            </div>
          </div>

          <div class="vs-slot" id="vsSlot">
            <!-- Phase label (stays above logo) -->
            <div id="phaseLabel" style="position:absolute;top:-50px;left:50%;transform:translateX(-50%);text-align:center;font-size:13px;color:var(--muted);pointer-events:none;z-index:900">Phase: <strong id="phaseCenter">PICK</strong></div>

            <!-- Upload button and preview inside slot (button on top) -->
            <div style="position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%">
              <button id="vsUploadBtn" class="btn" style="position:relative;z-index:3">Upload</button>
              <input type="file" id="vsFile" accept="image/*" style="display:none" />
              <img id="vsPreview" alt="VS" style="position:absolute;inset:0;margin:auto;z-index:2;display:none;border-radius:8px;object-fit:cover;width:100%;height:100%"/>
            </div>

            <!-- Timer placed below the slot (only timer moved) -->
            <div id="phaseTimer" style="position:absolute;top:110%;left:50%;transform:translateX(-50%);text-align:center;">
              <div id="timer">60</div>
            </div>
          </div>

          <!-- Team B (right) -->
          <div class="team teamB" id="teamB">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;justify-content:flex-end;width:100%">
              <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
                <div style="font-weight:700;text-align:right" id="teamBName">RED TEAM</div>
                <input id="teamBScore" class="team-score" value="0" />
              </div>
              <div id="teamBLogo" style="width:40px;height:40px;border:none;border-radius:6px;overflow:hidden;position:relative;cursor:pointer;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.05)">
                <span style="font-size:10px;color:#bbb">Logo</span>
                <input type="file" id="teamBLogoFile" accept="image/*" style="display:none" />
              </div>
            </div>
            <div class="pick-ban-wrapper">
              <div class="slot-row" id="teamB-picks">
                <div class="slot empty" data-team="B" data-index="0"><div class="label">P1</div><input id="scoreB" class="score-input" value="0" style="display:none"/></div>
                <div class="slot empty" data-team="B" data-index="1"><div class="label">P2</div></div>
                <div class="slot empty" data-team="B" data-index="2"><div class="label">P3</div></div>
                <div class="slot empty" data-team="B" data-index="3"><div class="label">P4</div></div>
                <div class="slot empty" data-team="B" data-index="4"><div class="label">P5</div></div>
              </div>
              <div class="bans" id="teamB-bans">
                <div class="ban" data-team="B" data-ban="0"></div>
                <div class="ban" data-team="B" data-ban="1"></div>
                <div class="ban" data-team="B" data-ban="2"></div>
                <div class="ban" data-team="B" data-ban="3"></div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="admin">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div style="font-weight:700">Admin / Controls</div>
        <div style="font-size:12px;color:var(--muted)">Local only • Use as OBS Browser Source</div>
      </div>

      <div class="field">
        <label>Team A name</label>
        <input id="inputTeamA" type="text" value="BLUE TEAM">
      </div>
      <div class="field">
        <label>Team B name</label>
        <input id="inputTeamB" type="text" value="RED TEAM">
      </div>

      <div class="field">
        <label>Action</label>
        <select id="action">
          <option value="pick">Pick</option>
          <option value="ban">Ban</option>
        </select>
      </div>

      <div class="field">
        <label>Active Team</label>
        <select id="activeTeam">
          <option value="A">Blue (Left)</option>
          <option value="B">Red (Right)</option>
        </select>
      </div>

      <div class="controls">
        <button id="doAction" class="btn">Apply</button>
        <button id="reset" class="btn ghost">Reset</button>
      </div>

      <div class="field">
        <label>Champion / Hero thumbnails (click to choose)</label>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="thumbSearch" type="text" placeholder="Search thumbnails..." style="flex:1;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.25);color:#fff" />
          <button id="clearSearch" class="btn ghost" style="padding:6px 8px">Clear</button>
        </div>
        <div class="thumbs" id="thumbs"></div>
        <input id="fileInput" type="file" accept="image/*" style="margin-top:8px" />
        <div class="status" id="status">No selected hero</div>
      </div>

      <div style="margin-top:12px">
        <small style="color:var(--muted)">Usage: upload images or click a thumbnail, choose action (Pick/Ban), choose active team, then "Apply". Drag this page into OBS as a Browser Source (use 1920x1080 for best fit).</small>
      </div>
    </div>
  </div>

  <script>
    // Helper to safely get element and warn
    function $id(id){ const el = document.getElementById(id); if(!el) console.warn('Missing element', id); return el }

    const thumbsEl = $id('thumbs');
    const fileInput = $id('fileInput');
    const status = $id('status');
    const actionSelect = $id('action');
    const activeTeam = $id('activeTeam');
    const doActionBtn = $id('doAction');
    const resetBtn = $id('reset');
    const teamAName = $id('inputTeamA');
    const teamBName = $id('inputTeamB');
    const teamANameView = $id('teamAName');
    const teamBNameView = $id('teamBName');
    const phaseEl = $id('phase');

    let thumbs = []; // {id,name,src}
    let selectedThumb = null;

    // Draft order sequence (user-provided)
    const draftOrder = [
      {type:'ban', team:'A'}, {type:'ban', team:'B'}, {type:'ban', team:'A'}, {type:'ban', team:'B'},
      {type:'pick', team:'A'}, {type:'pick', team:'B'}, {type:'pick', team:'B'}, {type:'pick', team:'A'},
      {type:'pick', team:'A'}, {type:'pick', team:'B'}, {type:'ban', team:'B'}, {type:'ban', team:'A'},
      {type:'ban', team:'B'}, {type:'ban', team:'A'}, {type:'pick', team:'B'}, {type:'pick', team:'A'},
      {type:'pick', team:'A'}, {type:'pick', team:'B'}
    ];

    let stepIndex = 0;

    function getTargetElementForStep(index){
      const step = draftOrder[index]; if(!step) return null;
      if(step.type === 'ban'){
        const els = document.querySelectorAll(`.ban[data-team='${step.team}']`);
        return Array.from(els).find(b=>!b.dataset.img) || null;
      } else {
        return document.querySelector(`.slot.empty[data-team='${step.team}']`);
      }
    }

    function highlightStep(index){
      clearHighlights();
      const el = getTargetElementForStep(index);
      if(!el) return;
      el.classList.add('flash');
      el.style.outline = '3px solid rgba(0,212,255,0.12)';
      // update phase display (center) automatically and uppercase
      const step = draftOrder[index];
      const phaseCenter = document.getElementById('phaseCenter');
      if(phaseCenter && step && step.type) phaseCenter.textContent = step.type.toUpperCase();
      // start timer for this step
      startTimerForStep(index);
    }

    function clearHighlights(){
      document.querySelectorAll('.flash').forEach(e=>e.classList.remove('flash'));
      document.querySelectorAll('.ban, .slot').forEach(e=>e.style.outline='none');
    }

    function applyAction(){
      if(!selectedThumb){ alert('Chọn 1 hero/champion trước (upload hoặc click thumbnail).'); return; }
      if(!actionSelect || !activeTeam) return;
      const act = actionSelect.value; const team = activeTeam.value;
      if(act==='pick'){
        const slot = document.querySelector(`.slot.empty[data-team='${team}']`);
        if(!slot){ alert('Không còn slot pick trống cho đội này.'); return; }
        fillSlot(slot, selectedThumb);
        slot.classList.add('pop'); setTimeout(()=>slot.classList.remove('pop'),220);
      } else {
        const ban = Array.from(document.querySelectorAll(`.ban[data-team='${team}']`)).find(b=>!b.dataset.img);
        if(!ban){ alert('Không còn slot ban trống cho đội này.'); return; }
        ban.dataset.img = selectedThumb.src; ban.title = selectedThumb.name;
        ban.classList.add('banned'); ban.innerHTML = `<img src="${selectedThumb.src}" alt="${selectedThumb.name}"/>`;
        ban.classList.add('flash'); setTimeout(()=>ban.classList.remove('flash'),800);
      }
    }

    function fillSlot(slot, thumb){
      slot.dataset.img = thumb.src; slot.dataset.name = thumb.name;
      slot.classList.remove('empty'); slot.innerHTML = `<img src="${thumb.src}" alt="${thumb.name}"/><div class='label'>${thumb.name}</div>`;
    }

    // Safe attach listeners only if elements exist
    if(doActionBtn) doActionBtn.addEventListener('click', ()=>{ stopTimer();
      const step = draftOrder[stepIndex]; if(!step) return;
      if(activeTeam) activeTeam.value = step.team;
      if(actionSelect) actionSelect.value = step.type;
      if(phaseEl) phaseEl.textContent = step.type.toUpperCase();
      const phaseCenter = document.getElementById('phaseCenter');
      if(phaseCenter) phaseCenter.textContent = step.type;

      if(selectedThumb){ applyAction(); }
      else { const target = getTargetElementForStep(stepIndex); if(target){ target.classList.add('flash'); setTimeout(()=>{ if(target) target.classList.remove('flash'); },700); } }

      stepIndex++; if(stepIndex >= draftOrder.length) stepIndex = draftOrder.length - 1;
      highlightStep(stepIndex);
    });

    if(resetBtn) resetBtn.addEventListener('click', ()=> resetAll());

    function resetAll(){
      document.querySelectorAll('.slot').forEach(s=>{ s.innerHTML = `<div class='label'>P${parseInt(s.dataset.index)+1}</div>`; s.classList.add('empty'); delete s.dataset.img; delete s.dataset.name; });
      document.querySelectorAll('.ban').forEach(b=>{ b.innerHTML=''; delete b.dataset.img; delete b.title; });
      if(phaseEl) phaseEl.textContent = 'PICK';
      stepIndex = 0; clearHighlights(); highlightStep(stepIndex);
    }

    if(teamAName) teamAName.addEventListener('input', ()=>{ if(teamANameView) teamANameView.textContent = teamAName.value; });
    if(teamBName) teamBName.addEventListener('input', ()=>{ if(teamBNameView) teamBNameView.textContent = teamBName.value; });

    function makePlaceholder(text, bg){ const c = document.createElement('canvas'); c.width=200; c.height=200; const ctx=c.getContext('2d'); ctx.fillStyle=bg||'#223344'; ctx.fillRect(0,0,c.width,c.height); ctx.fillStyle='#fff'; ctx.font='bold 36px monospace'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(text, c.width/2, c.height/2); return c.toDataURL(); }

    const defaults = ['Aatrox','Braum','Corki','Diana','Ekko','Fiora','Garen','Hecarim'];
    defaults.forEach((n,i)=> thumbs.push({id:i,name:n,src:makePlaceholder(n.substr(0,2), i%2? '#2b3a4a':'#1d2836')}));

    function renderThumbs(){
      if(!thumbsEl) return;
      const qEl = document.getElementById('thumbSearch');
      const q = qEl ? qEl.value.trim().toLowerCase() : '';
      thumbsEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      thumbs.filter(t => {
        if(!q) return true;
        return (t.name||'').toLowerCase().includes(q);
      }).forEach(t => {
        const d = document.createElement('div');
        d.className = 'thumb';
        d.dataset.id = t.id;
        const img = document.createElement('img');
        img.src = t.src;
        d.appendChild(img);
        const nm = document.createElement('div');
        nm.className = 'name';
        nm.textContent = t.name;
        d.appendChild(nm);
        d.addEventListener('click', ()=>{ selectThumb(t.id); });
        frag.appendChild(d);
      });
      thumbsEl.appendChild(frag);
    }

    function selectThumb(id){
      // set selected thumbnail
      selectedThumb = thumbs.find(x=>x.id==id);
      if(!selectedThumb) return;
      if(status) status.textContent = `Selected: ${selectedThumb.name}`;
      document.querySelectorAll('.thumb').forEach(el=>el.style.outline='none');
      const el = document.querySelector(`.thumb[data-id='${id}']`);
      if(el) el.style.outline = '2px solid rgba(0,212,255,0.14)';

      // show a non-destructive preview on the current target slot/ban for the current step
      clearAllPreviews();
      const target = getTargetElementForStep(stepIndex);
      if(target && selectedThumb){
        showPreviewOnElement(target, selectedThumb.src, selectedThumb.name);
      }
    }

    function showPreviewOnElement(el, src, name){
      if(!el) return;
      // don't overwrite an already committed image (dataset.img)
      if(el.dataset && el.dataset.img) return;
      // create or update preview img
      let p = el.querySelector('.preview-img');
      if(!p){ p = document.createElement('img'); p.className = 'preview-img'; p.alt = name || '';
        p.style.position = 'absolute'; p.style.top = '0'; p.style.left = '0'; p.style.width = '100%'; p.style.height = '100%'; p.style.objectFit = 'cover'; p.style.opacity = '0.65'; p.style.pointerEvents = 'none';
        el.appendChild(p);
      }
      p.src = src;
    }

    function clearPreviewOnElement(el){ if(!el) return; const p = el.querySelector('.preview-img'); if(p) p.remove(); }
    function clearAllPreviews(){ document.querySelectorAll('.slot, .ban').forEach(e=>{ clearPreviewOnElement(e); }); }

    // Champion thumbnail upload (admin panel)
    if(fileInput) fileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        const id = Date.now();
        thumbs.push({id,name:f.name.split('.').slice(0,-1).join('.')||f.name,src:reader.result});
        renderThumbs();
        selectThumb(id);
      };
      reader.readAsDataURL(f);
    });

    // Bulk import: select multiple image files or a folder (webkitdirectory)
    const bulkInput = document.createElement('input');
    bulkInput.type = 'file';
    bulkInput.multiple = true;
    bulkInput.setAttribute('webkitdirectory', '');
    bulkInput.style.display = 'block';
    bulkInput.style.marginTop = '6px';
    bulkInput.id = 'bulkInput';
    const thumbsContainer = document.getElementById('thumbs');
    if(thumbsContainer) thumbsContainer.parentNode.insertBefore(bulkInput, thumbsContainer.nextSibling);

    bulkInput.addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files || []);
      if(!files.length) return;
      // read image files only
      const imgFiles = files.filter(f=>f.type && f.type.startsWith('image/'));
      for(const f of imgFiles){
        await new Promise(resolve=>{
          const r = new FileReader();
          r.onload = ()=>{
            const id = Date.now() + Math.floor(Math.random()*1000);
            thumbs.push({id,name:f.name,src:r.result});
            resolve();
          };
          r.readAsDataURL(f);
        });
      }
      renderThumbs();
      if(thumbs.length) selectThumb(thumbs[thumbs.length-1].id);
    });

    // Team logo upload handlers
const teamALogo = document.getElementById('teamALogo');
const teamALogoFile = document.getElementById('teamALogoFile');
const teamBLogo = document.getElementById('teamBLogo');
const teamBLogoFile = document.getElementById('teamBLogoFile');

function setupLogoUpload(box, file){
  if(!box || !file) return;
  box.addEventListener('click', ()=> file.click());
  file.addEventListener('change', e=>{
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      box.innerHTML = `<img src="${reader.result}" style='width:100%;height:100%;object-fit:contain'/>`;
    };
    reader.readAsDataURL(f);
  });
}

setupLogoUpload(teamALogo, teamALogoFile);
setupLogoUpload(teamBLogo, teamBLogoFile);

// VS upload handler
    const vsUploadBtn = document.getElementById('vsUploadBtn');
    const vsFile = document.getElementById('vsFile');
    const vsPreview = document.getElementById('vsPreview');

    if(vsUploadBtn && vsFile){
      vsUploadBtn.addEventListener('click', ()=> vsFile.click());
      vsFile.addEventListener('change', e=>{
        const f = e.target.files[0];
        if(!f) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          // set src and styles properly (fixed syntax error)
          vsPreview.src = reader.result;
          vsPreview.style.display = 'block';
          vsPreview.style.height = '100%';
          vsPreview.style.objectFit = 'cover';
          // hide upload button after image loads
          vsUploadBtn.style.display = 'none';
          // make preview clickable to re-upload
          vsPreview.addEventListener('click', ()=> vsFile.click());
        };
        reader.readAsDataURL(f);
      });
    }

    // init
    renderThumbs(); if(thumbs.length) selectThumb(thumbs[0].id);
    // wire search input
    const thumbSearch = document.getElementById('thumbSearch');
    const clearSearch = document.getElementById('clearSearch');
    if(thumbSearch){ thumbSearch.addEventListener('input', ()=>{ renderThumbs(); }); }
    if(clearSearch){ clearSearch.addEventListener('click', ()=>{ if(thumbSearch) thumbSearch.value=''; renderThumbs(); }); }

    // Timer logic (30s ban, 60s pick)
    const timerEl = document.getElementById('timer');
    let timerInterval = null;
    let timerRemaining = 0;

    function startTimerForStep(index){
      stopTimer();
      const step = draftOrder[index]; if(!step) return;
      const seconds = step.type === 'ban' ? 30 : 60;
      timerRemaining = seconds;
      if(timerEl) timerEl.textContent = String(timerRemaining);
      timerInterval = setInterval(()=>{
        timerRemaining -= 1;
        if(timerEl) timerEl.textContent = String(timerRemaining);
        if(timerRemaining <= 0){
          clearInterval(timerInterval); timerInterval = null;
          autoAdvanceOnTimeout();
        }
      }, 1000);
    }

    function stopTimer(){ if(timerInterval){ clearInterval(timerInterval); timerInterval = null; } }

    function autoAdvanceOnTimeout(){
      const step = draftOrder[stepIndex];
      if(!step) return;
      // if selectedThumb exists try to apply action automatically; otherwise just advance
      if(selectedThumb){ doActionBtn && doActionBtn.click(); }
      else { stepIndex++; if(stepIndex >= draftOrder.length) stepIndex = draftOrder.length - 1; highlightStep(stepIndex); }
    }

    document.addEventListener('keydown', (e)=>{ if(e.key && e.key.toLowerCase() === 'l'){ if(activeTeam) activeTeam.value = activeTeam.value === 'A' ? 'B' : 'A'; } });

    document.addEventListener('click', (e)=>{
      const slot = e.target.closest('.slot');
      if(slot && slot.dataset.img){ if(confirm('Clear this slot?')){ slot.innerHTML = `<div class='label'>P${parseInt(slot.dataset.index)+1}</div>`; slot.classList.add('empty'); delete slot.dataset.img; delete slot.dataset.name; } }
      const ban = e.target.closest('.ban'); if(ban && ban.dataset.img){ if(confirm('Clear this ban?')){ ban.innerHTML=''; delete ban.dataset.img; delete ban.title; } }
    });

    highlightStep(stepIndex);

    // applyQueryDefaults: read url params width/height and set overlay width if present
    function applyQueryDefaults(){
      const params = new URLSearchParams(location.search);
      const w = params.get('width');
      const h = params.get('height');
      if(w && document.querySelector('.overlay')) document.querySelector('.overlay').style.width = w + 'px';
      // hide admin in live mode
      if(params.get('live') === '1'){
        const adminPanel = document.querySelector('.admin');
        if(adminPanel) adminPanel.style.display = 'none';
      }
    }

    applyQueryDefaults();
  </script>
</body>
</html>
